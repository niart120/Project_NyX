# 通信プロトコル抽象化設計詳細

このドキュメントでは、シリアル通信におけるプロトコル変換部分の設計について説明します。

## 1. 目的と背景

- **目的:**  
  高レベル操作（例：press, release, keyboard）のパラメータを、シリアル通信で送信可能なバイナリデータに変換する。
  
- **背景:**  
  自動操作層（Command, DefaultCommand）は、具体的な通信プロトコルの詳細を意識することなく操作を記述できるようにするため、 プロトコル変換処理を独立させる必要があります。

## 2. 設計方針

- **抽象化:**  
  `SerialProtocolInterface` を定義し、プロトコル変換の共通インターフェースを提供します。  
- **具体的実装:**  
  CH552デバイス向けのプロトコル実装として、`CH552SerialProtocol`（本仕様は [ch552_protocol_spec.md](./ch552_protocol_spec.md) を参照）を提供します。
- **責務分離:**  
  - **Command (DefaultCommand):**  
    ユーザー操作から発生するパラメータを、プロトコル変換のために `SerialProtocolInterface` の実装を呼び出す。  
  - **SerialManager:**  
    生成されたコマンドデータを、実際のシリアル通信で送信する。

## 3. 連携フロー

1. **操作発行:**  
   自動操作層（DefaultCommand）が、例えば `press()` を呼び出すと、  
   渡されたキー情報を元に、注入されたプロトコル実装（例：CH552SerialProtocol）でバイナリデータを生成します。

2. **送信:**  
   生成されたコマンドデータは SerialManager に渡され、アクティブなシリアルデバイスに送信されます。

## 4. 将来的な拡張

- **複数プロトコル対応:**  
  SerialProtocolInterface を拡張することで、他のデバイス向けのプロトコル実装への切り替えが可能です。  
- **手動入力との統合:**  
  将来的に手動入力層でも同様のプロトコル変換が必要な場合、共通のインターフェースを利用することで再利用性が高まります。

---

このドキュメントでは、プロトコル変換処理の抽象化と、その具体的実装としての CH552SerialProtocol の概要を説明しています。  
詳細な CH552SerialProtocol の仕様については、[ch552_protocol_spec.md](./ch552_protocol_spec.md) を参照してください。