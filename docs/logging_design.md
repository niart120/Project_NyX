# ログ管理設計詳細

このドキュメントでは、Project NyX におけるログ管理機能の設計方針と実装計画について説明します。

---

## 1. 目的

ログ管理機能は、以下の目的を達成するために設計されます：

1. **デバッグ支援:**  
   開発者が動作不備やエラーを迅速に特定できるようにする。
   
2. **ユーザー通知:**  
   マクロ実行中の状況をユーザーに分かりやすく通知する。

3. **エラーログ:**  
   ハードウェアやマクロのエラーを記録し、問題解決の手がかりを提供する。

4. **拡張性:**  
   将来的な機能追加（リモートログ送信、GUI 表示など）に対応可能な設計とする。

---

## 2. ログの分類

ログは用途に応じて以下の4つに分類されます：

### 2.1 ユーザー通知ログ
- **目的:**  
  マクロ作成者が、マクロの実行状況をユーザーに通知するためのログ。
- **特徴:**  
  - 簡潔で分かりやすいメッセージ。
  - GUI や CLI にリアルタイムで表示される。
  - ログファイルには保存しない可能性がある。
- **例:**  
  - 「マクロが開始されました」
  - 「ボタンAを押しました」

### 2.2 デバッグログ
- **目的:**  
  開発者が操作のデバッグや動作不備の検知を行うための内部ログ。
- **特徴:**  
  - 詳細な情報を含む。
  - ログレベル（DEBUG, INFO, WARNING, ERROR）に応じて出力を制御可能。
  - ログファイルに保存される。
- **例:**  
  - 「SerialManager: デバイス 'COM3' に接続しました」
  - 「CH552Protocol: ボタンAの押下コマンドを生成しました」

### 2.3 フレームワークログ
- **目的:**  
  フレームワーク内部の動作状況を記録するためのログ。
- **特徴:**  
  - フレームワークの内部状態を記録。
  - デバッグログと同様にログレベルで制御可能。
  - ログファイルに保存される。
- **例:**  
  - 「MacroExecutor: マクロの初期化を開始しました」
  - 「CaptureManager: フレームを取得しました」

### 2.4 エラーログ
- **目的:**  
  ハードウェアやマクロのエラーを記録し、問題解決の手がかりを提供する。
- **特徴:**  
  - 重大なエラーを記録。
  - ユーザー通知ログやデバッグログと連携する場合がある。
  - ログファイルに保存される。
- **例:**  
  - 「CaptureDevice: デバイスが接続されていません」
  - 「MacroExecutor: マクロ実行中に例外が発生しました」

---

## 3. ログ管理の設計方針

### 3.1 ログレベル
ログ出力には以下のログレベルを採用します：
- **DEBUG:** 詳細なデバッグ情報。
- **INFO:** 一般的な情報。
- **WARNING:** 注意が必要な状態。
- **ERROR:** 重大なエラー。
- **CRITICAL:** システム全体に影響を与える致命的なエラー。

### 3.2 ログの出力先
- **コンソール:**  
  ユーザー通知ログやデバッグログをリアルタイムで表示。
- **ログファイル:**  
  デバッグログ、フレームワークログ、エラーログを保存。
- **GUI:**  
  必要に応じてユーザー通知ログを表示。

### 3.3 ログのフォーマット
- **標準フォーマット:**  
  `[タイムスタンプ] [ログレベル] [コンポーネント名] メッセージ`  
  例: `[2025-01-01 12:00:00] [INFO] [MacroExecutor] マクロの初期化を開始`

### 3.4 ログのモジュール化
- ログ管理は専用の `LogManager` クラスで一元管理します。
- 各コンポーネント（マクロ、フレームワーク、デバイス）は `LogManager` を利用してログを出力します。

---

## 4. 実装計画

### 4.1 LogManager クラス
- **責務:**  
  ログの出力先やフォーマット、ログレベルの設定を管理。
- **主なメソッド:**
  - `log(level, message, component)`: ログを出力。
  - `set_level(level)`: ログレベルを設定。
  - `add_handler(handler)`: 出力先（コンソール、ファイルなど）を追加。

### 4.2 ログの統合
- **マクロ:**  
  `Command.log()` メソッドを `LogManager` に統合。
- **フレームワーク:**  
  `MacroExecutor` や `SerialManager` でのログ出力を `LogManager` に統一。
- **デバイス:**  
  キャプチャデバイスやシリアル通信のエラーを `LogManager` 経由で記録。

### 4.3 ユーザー通知ログの分離
- ユーザー通知ログは専用の通知システム（例: `NotificationManager`）を検討。

---

## 5. 将来的な拡張

- **GUIとの連携:**  
  ログをリアルタイムでGUIに表示する機能を追加。
- **リモートログ:**  
  ログをリモートサーバーに送信する仕組みを検討。
- **ログのフィルタリング:**  
  ユーザーが特定のログレベルやコンポーネントのログのみを表示できる機能を追加。

---

この設計に基づき、`LogManager` の実装を進め、各コンポーネントへの統合を行います。